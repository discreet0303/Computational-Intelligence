import math
import random
import copy
import numpy as np

from src.algorithm.Gene import Gene
from src.file.File import File

class GeneAlgorithm():
    
    def __init__(self):
        self.iteration = 1

        self.genePoolSize = 100
        self.genePool = []

        self.bestGene = Gene()

        self.file = File()
        self.senRecord, self.wheelRecord = self.file.getCarRecordForGene('train4D.txt')
        self.recordNormalization()
        self.testing(1,1,1)

    def testing(self, fSen, rSen, lSen):
        vector = [
            0.27413031070271554,-0.2165564702584432,0.43570801383368407,0.25766919736016813,0.8162115275208734,0.8162821060763124,0.8202941611263892,0.42819618155989114,0.08077460452911274,5.824353208226845,13.444845433520543,25.843555157662887,24.72074663331964,27.2452876319428,4.26792413219178,29.879182972982075,17.71580854125198,6.590448633825639,0.8439619974605179,25.090933045508315,15.210407312007572,26.40874256181456,25.714038156109435,29.958432120639543,0.3486954447339934,29.887137298021543,22.942949780787536,23.7447902299137,19.17562948615331,7.703035677504062,6.924410903031947,14.185147813621386,10.955673223625558,3.9415175026251936,9.477755884503381,0.2730688547204743,8.259032578761945,2.933900572696063,3.3994091470723804,9.982899337717233,1.196458072994222
        ]
        self.bestGene.updateVector(vector)
        print('testing')
        print(self.bestGene)
        print(self.bestGene.vector)
        print(self.bestGene.RBFN.theta)
        print(self.bestGene.RBFN.M)
        print(self.bestGene.getFitness(self.wheelRecord, self.senRecord))

        return self.bestGene.RBFN.getOutput([fSen, rSen, lSen]) * 80 - 40

    def recordNormalization(self):
        for index, wheel in enumerate(self.wheelRecord):
            self.wheelRecord[index] = (np.array(wheel) + 40) / 80

    
    
    # vector = [
    #     0.27413031070271554,-0.2165564702584432,0.43570801383368407,0.25766919736016813,0.8162115275208734,0.8162821060763124,0.8202941611263892,0.42819618155989114,0.08077460452911274,5.824353208226845,13.444845433520543,25.843555157662887,24.72074663331964,27.2452876319428,4.26792413219178,29.879182972982075,17.71580854125198,6.590448633825639,0.8439619974605179,25.090933045508315,15.210407312007572,26.40874256181456,25.714038156109435,29.958432120639543,0.3486954447339934,29.887137298021543,22.942949780787536,23.7447902299137,19.17562948615331,7.703035677504062,6.924410903031947,14.185147813621386,10.955673223625558,3.9415175026251936,9.477755884503381,0.2730688547204743,8.259032578761945,2.933900572696063,3.3994091470723804,9.982899337717233,1.196458072994222
    # ]